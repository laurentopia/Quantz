<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Yield ETF Comparison Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }
        
        .ticker-analyzer {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #667eea;
        }
        
        .ticker-analyzer h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .ticker-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .ticker-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }
        
        .ticker-button:hover {
            background: #5568d3;
        }
        
        .ticker-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .ticker-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .ticker-status.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .ticker-status.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .control-group h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .etf1 {
            border-color: #667eea;
        }
        
        .etf2 {
            border-color: #f093fb;
        }
        
        .global {
            border-color: #4ecdc4;
            grid-column: 1 / -1;
        }
        
        .input-row {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 0.9em;
        }
        
        input[type="number"], input[type="text"], input[type="date"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus, input[type="text"]:focus, input[type="date"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .checkbox-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .checkbox-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .checkbox-row label {
            margin-bottom: 0;
            cursor: pointer;
        }
        
        .chart-container {
            position: relative;
            height: 500px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .summary-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .summary-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 5px;
        }
        
        .summary-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .summary-value {
            color: #333;
            font-weight: bold;
            font-size: 0.95em;
        }
        
        .share-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }
        
        .share-button {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .share-button:hover {
            background: #45b8b0;
        }
        
        .url-display {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            word-break: break-all;
            font-family: monospace;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä High Yield ETF Comparison Tool</h1>
        <p class="subtitle">Compare distributions, NAV decay, and DRIP strategies over time</p>
        
        <div class="ticker-analyzer">
            <h3>üîç Ticker Analyzer</h3>
            <div class="ticker-inputs">
                <div class="input-row">
                    <label>Ticker Symbol (ETF 1)</label>
                    <input type="text" id="ticker1" placeholder="e.g., ULTY">
                </div>
                <div class="input-row">
                    <label>Ticker Symbol (ETF 2)</label>
                    <input type="text" id="ticker2" placeholder="e.g., JEPI">
                </div>
                <div class="input-row">
                    <label>Start Date</label>
                    <input type="date" id="startDate">
                </div>
                <div class="input-row">
                    <label>End Date</label>
                    <input type="date" id="endDate">
                </div>
            </div>
            <button class="ticker-button" onclick="analyzeTickers()">Analyze Tickers</button>
            <div class="ticker-status" id="tickerStatus"></div>
        </div>
        
        <div class="controls">
            <div class="control-group global">
                <h3>‚öôÔ∏è Global Settings</h3>
                <div class="input-row">
                    <label>Time Frame (weeks)</label>
                    <input type="number" id="timeFrame" value="260" min="1" oninput="updateCalculations()">
                </div>
            </div>
            
            <div class="control-group etf1">
                <h3>üìà ETF 1</h3>
                <div class="input-row">
                    <label>Initial NAV ($)</label>
                    <input type="number" id="nav1" value="100" step="0.01" oninput="updateCalculations()">
                </div>
                <div class="checkbox-row">
                    <input type="checkbox" id="decoupleNav1" onchange="toggleDecoupleNav1()">
                    <label for="decoupleNav1">Decouple Yield from NAV (Absolute $/week)</label>
                </div>
                <div class="input-row">
                    <label>NAV Decay Rate (%/week)</label>
                    <input type="number" id="navDecay1" value="-0.1" step="0.01" oninput="updateCalculations()">
                </div>
                <div class="input-row">
                    <label>Distribution Yield (%/week)</label>
                    <input type="number" id="distro1" value="0.5" step="0.01" oninput="updateCalculations()">
                </div>
                <div class="input-row">
                    <label>Distribution Decay Rate (%/week)</label>
                    <input type="number" id="distroDecay1" value="0" step="0.01" oninput="updateCalculations()">
                </div>
            </div>
            
            <div class="control-group etf2">
                <h3>üìâ ETF 2</h3>
                <div class="input-row">
                    <label>Initial NAV ($)</label>
                    <input type="number" id="nav2" value="100" step="0.01" oninput="updateCalculations()">
                </div>
                <div class="checkbox-row">
                    <input type="checkbox" id="decoupleNav2" onchange="toggleDecoupleNav2()">
                    <label for="decoupleNav2">Decouple Yield from NAV (Absolute $/week)</label>
                </div>
                <div class="input-row">
                    <label>NAV Decay Rate (%/week)</label>
                    <input type="number" id="navDecay2" value="0" step="0.01" oninput="updateCalculations()">
                </div>
                <div class="input-row">
                    <label>Distribution Yield (%/week)</label>
                    <input type="number" id="distro2" value="0.2" step="0.01" oninput="updateCalculations()">
                </div>
                <div class="input-row">
                    <label>Distribution Decay Rate (%/week)</label>
                    <input type="number" id="distroDecay2" value="0" step="0.01" oninput="updateCalculations()">
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>
        
        <div class="summary">
            <div class="summary-card">
                <h4>üìä ETF 1 Summary</h4>
                <div class="summary-item">
                    <span class="summary-label">Total Distributions:</span>
                    <span class="summary-value" id="totalDistro1">$0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Final NAV:</span>
                    <span class="summary-value" id="finalNav1">$0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Return (No DRIP):</span>
                    <span class="summary-value" id="totalReturn1">$0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Return (DRIP):</span>
                    <span class="summary-value" id="totalReturnDrip1">$0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">DRIP Shares Acquired:</span>
                    <span class="summary-value" id="dripShares1">0.00</span>
                </div>
            </div>
            
            <div class="summary-card">
                <h4>üìâ ETF 2 Summary</h4>
                <div class="summary-item">
                    <span class="summary-label">Total Distributions:</span>
                    <span class="summary-value" id="totalDistro2">$0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Final NAV:</span>
                    <span class="summary-value" id="finalNav2">$0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Return (No DRIP):</span>
                    <span class="summary-value" id="totalReturn2">$0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Return (DRIP):</span>
                    <span class="summary-value" id="totalReturnDrip2">$0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">DRIP Shares Acquired:</span>
                    <span class="summary-value" id="dripShares2">0.00</span>
                </div>
            </div>
        </div>
        
        <div class="share-section">
            <h3>üîó Share This Simulation</h3>
            <button class="share-button" onclick="copyUrlToClipboard()">Copy URL to Clipboard</button>
            <button class="share-button" onclick="resetToDefaults()">Reset to Defaults</button>
            <div class="url-display" id="urlDisplay"></div>
        </div>
    </div>

    <script>
        let chart;
        let isLoadingFromUrl = false;
        
        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                generateLabels: function(chart) {
                                    const original = Chart.defaults.plugins.legend.labels.generateLabels;
                                    const labels = original.call(this, chart);
                                    
                                    labels.forEach(label => {
                                        if (label.text.includes('DRIP')) {
                                            label.pointStyle = 'rect';
                                            label.fillStyle = 'transparent';
                                            label.strokeStyle = label.strokeStyle;
                                        }
                                    });
                                    
                                    return labels;
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += '$' + context.parsed.y.toFixed(2);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Week'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Value ($)'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Toggle decouple NAV
        function toggleDecoupleNav1() {
            const checkbox = document.getElementById('decoupleNav1');
            const label = document.querySelector('label[for="distro1"]');
            if (checkbox.checked) {
                label.textContent = 'Absolute Distribution ($/week)';
            } else {
                label.textContent = 'Distribution Yield (%/week)';
            }
            updateCalculations();
        }
        
        function toggleDecoupleNav2() {
            const checkbox = document.getElementById('decoupleNav2');
            const label = document.querySelector('label[for="distro2"]');
            if (checkbox.checked) {
                label.textContent = 'Absolute Distribution ($/week)';
            } else {
                label.textContent = 'Distribution Yield (%/week)';
            }
            updateCalculations();
        }
        
        // Calculate ETF values
        function calculateETF(initialNav, navDecayRate, distroRate, distroDecayRate, weeks, decoupled) {
            const navValues = [];
            const cumulativeDistro = [];
            const dripValues = [];
            
            let nav = initialNav;
            let totalDistro = 0;
            let shares = 1; // Start with 1 share
            let dripShares = 1; // DRIP starts with 1 share too
            
            for (let week = 0; week <= weeks; week++) {
                navValues.push(nav);
                cumulativeDistro.push(totalDistro);
                
                // Calculate DRIP value (NAV * total shares)
                dripValues.push(nav * dripShares);
                
                if (week < weeks) {
                    // Calculate distribution for this week
                    let weeklyDistro;
                    if (decoupled) {
                        // Absolute distribution
                        weeklyDistro = distroRate * shares;
                    } else {
                        // Percentage of NAV
                        weeklyDistro = (nav * distroRate / 100) * shares;
                    }
                    
                    // Apply distribution decay
                    const decayedDistroRate = distroRate * Math.pow(1 + distroDecayRate / 100, week);
                    if (decoupled) {
                        weeklyDistro = decayedDistroRate * shares;
                    } else {
                        weeklyDistro = (nav * decayedDistroRate / 100) * shares;
                    }
                    
                    totalDistro += weeklyDistro;
                    
                    // DRIP: reinvest distribution to buy more shares
                    if (nav > 0) {
                        const newShares = weeklyDistro / nav;
                        dripShares += newShares;
                    }
                    
                    // Update NAV for next week
                    nav = nav * (1 + navDecayRate / 100);
                }
            }
            
            return {
                navValues,
                cumulativeDistro,
                dripValues,
                finalNav: navValues[weeks],
                totalDistro: totalDistro,
                dripShares: dripShares - 1 // Subtract initial share
            };
        }
        
        // Update calculations and chart
        function updateCalculations() {
            const weeks = parseInt(document.getElementById('timeFrame').value);
            
            // ETF 1
            const nav1 = parseFloat(document.getElementById('nav1').value);
            const navDecay1 = parseFloat(document.getElementById('navDecay1').value);
            const distro1 = parseFloat(document.getElementById('distro1').value);
            const distroDecay1 = parseFloat(document.getElementById('distroDecay1').value);
            const decoupled1 = document.getElementById('decoupleNav1').checked;
            
            // ETF 2
            const nav2 = parseFloat(document.getElementById('nav2').value);
            const navDecay2 = parseFloat(document.getElementById('navDecay2').value);
            const distro2 = parseFloat(document.getElementById('distro2').value);
            const distroDecay2 = parseFloat(document.getElementById('distroDecay2').value);
            const decoupled2 = document.getElementById('decoupleNav2').checked;
            
            // Calculate both ETFs
            const etf1 = calculateETF(nav1, navDecay1, distro1, distroDecay1, weeks, decoupled1);
            const etf2 = calculateETF(nav2, navDecay2, distro2, distroDecay2, weeks, decoupled2);
            
            // Prepare chart data
            const labels = Array.from({length: weeks + 1}, (_, i) => i);
            
            chart.data.labels = labels;
            chart.data.datasets = [
                // ETF 1 NAV (dashed, thin)
                {
                    label: 'ETF 1 NAV',
                    data: etf1.navValues,
                    borderColor: 'rgba(102, 126, 234, 0.6)',
                    backgroundColor: 'rgba(102, 126, 234, 0.0)',
                    borderWidth: 1,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: false
                },
                // ETF 1 Cumulative Distribution (filled)
                {
                    label: 'ETF 1 Cumulative Distribution',
                    data: etf1.cumulativeDistro,
                    borderColor: 'rgba(102, 126, 234, 1)',
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true
                },
                // ETF 1 DRIP
                {
                    label: 'ETF 1 Total Return (DRIP)',
                    data: etf1.dripValues,
                    borderColor: 'rgba(102, 126, 234, 1)',
                    backgroundColor: 'rgba(102, 126, 234, 0.0)',
                    borderWidth: 2,
                    borderDash: [2, 2],
                    pointRadius: 0,
                    pointStyle: 'rect',
                    fill: false
                },
                // ETF 2 NAV (dashed, thin)
                {
                    label: 'ETF 2 NAV',
                    data: etf2.navValues,
                    borderColor: 'rgba(240, 147, 251, 0.6)',
                    backgroundColor: 'rgba(240, 147, 251, 0.0)',
                    borderWidth: 1,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: false
                },
                // ETF 2 Cumulative Distribution (filled)
                {
                    label: 'ETF 2 Cumulative Distribution',
                    data: etf2.cumulativeDistro,
                    borderColor: 'rgba(240, 147, 251, 1)',
                    backgroundColor: 'rgba(240, 147, 251, 0.2)',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true
                },
                // ETF 2 DRIP
                {
                    label: 'ETF 2 Total Return (DRIP)',
                    data: etf2.dripValues,
                    borderColor: 'rgba(240, 147, 251, 1)',
                    backgroundColor: 'rgba(240, 147, 251, 0.0)',
                    borderWidth: 2,
                    borderDash: [2, 2],
                    pointRadius: 0,
                    pointStyle: 'rect',
                    fill: false
                }
            ];
            
            chart.update('none');
            
            // Update summary
            document.getElementById('totalDistro1').textContent = '$' + etf1.totalDistro.toFixed(2);
            document.getElementById('finalNav1').textContent = '$' + etf1.finalNav.toFixed(2);
            document.getElementById('totalReturn1').textContent = '$' + (etf1.finalNav + etf1.totalDistro).toFixed(2);
            document.getElementById('totalReturnDrip1').textContent = '$' + etf1.dripValues[weeks].toFixed(2);
            document.getElementById('dripShares1').textContent = etf1.dripShares.toFixed(4);
            
            document.getElementById('totalDistro2').textContent = '$' + etf2.totalDistro.toFixed(2);
            document.getElementById('finalNav2').textContent = '$' + etf2.finalNav.toFixed(2);
            document.getElementById('totalReturn2').textContent = '$' + (etf2.finalNav + etf2.totalDistro).toFixed(2);
            document.getElementById('totalReturnDrip2').textContent = '$' + etf2.dripValues[weeks].toFixed(2);
            document.getElementById('dripShares2').textContent = etf2.dripShares.toFixed(4);
            
            // Update URL if not loading from URL
            if (!isLoadingFromUrl) {
                updateUrl();
            }
        }
        
        // URL state management
        function updateUrl() {
            const params = new URLSearchParams();
            params.set('weeks', document.getElementById('timeFrame').value);
            params.set('nav1', document.getElementById('nav1').value);
            params.set('navDecay1', document.getElementById('navDecay1').value);
            params.set('distro1', document.getElementById('distro1').value);
            params.set('distroDecay1', document.getElementById('distroDecay1').value);
            params.set('decouple1', document.getElementById('decoupleNav1').checked ? '1' : '0');
            params.set('nav2', document.getElementById('nav2').value);
            params.set('navDecay2', document.getElementById('navDecay2').value);
            params.set('distro2', document.getElementById('distro2').value);
            params.set('distroDecay2', document.getElementById('distroDecay2').value);
            params.set('decouple2', document.getElementById('decoupleNav2').checked ? '1' : '0');
            
            const newUrl = window.location.pathname + '?' + params.toString();
            window.history.replaceState({}, '', newUrl);
            
            document.getElementById('urlDisplay').textContent = window.location.href;
        }
        
        function loadFromUrl() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.size === 0) return;
            
            isLoadingFromUrl = true;
            
            if (params.has('weeks')) document.getElementById('timeFrame').value = params.get('weeks');
            if (params.has('nav1')) document.getElementById('nav1').value = params.get('nav1');
            if (params.has('navDecay1')) document.getElementById('navDecay1').value = params.get('navDecay1');
            if (params.has('distro1')) document.getElementById('distro1').value = params.get('distro1');
            if (params.has('distroDecay1')) document.getElementById('distroDecay1').value = params.get('distroDecay1');
            if (params.has('decouple1')) {
                document.getElementById('decoupleNav1').checked = params.get('decouple1') === '1';
                toggleDecoupleNav1();
            }
            if (params.has('nav2')) document.getElementById('nav2').value = params.get('nav2');
            if (params.has('navDecay2')) document.getElementById('navDecay2').value = params.get('navDecay2');
            if (params.has('distro2')) document.getElementById('distro2').value = params.get('distro2');
            if (params.has('distroDecay2')) document.getElementById('distroDecay2').value = params.get('distroDecay2');
            if (params.has('decouple2')) {
                document.getElementById('decoupleNav2').checked = params.get('decouple2') === '1';
                toggleDecoupleNav2();
            }
            
            isLoadingFromUrl = false;
            updateCalculations();
        }
        
        function copyUrlToClipboard() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('URL copied to clipboard!');
            });
        }
        
        function resetToDefaults() {
            window.location.href = window.location.pathname;
        }
        
        // Ticker analyzer
        async function analyzeTickers() {
            const ticker1 = document.getElementById('ticker1').value.toUpperCase();
            const ticker2 = document.getElementById('ticker2').value.toUpperCase();
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const statusDiv = document.getElementById('tickerStatus');
            
            if (!ticker1 && !ticker2) {
                statusDiv.className = 'ticker-status error';
                statusDiv.textContent = 'Please enter at least one ticker symbol.';
                return;
            }
            
            if (!startDate || !endDate) {
                statusDiv.className = 'ticker-status error';
                statusDiv.textContent = 'Please select both start and end dates.';
                return;
            }
            
            statusDiv.className = 'ticker-status';
            statusDiv.style.display = 'block';
            statusDiv.textContent = 'Analyzing tickers... This feature requires a financial data API. Please note: This is a demonstration interface.';
            
            // Note: This would require integration with a financial data API like Alpha Vantage, Yahoo Finance, or similar
