<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Yield ETF Comparator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #1e3a5f;
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .etf-group {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .etf-group h3 {
            margin-top: 0;
            color: #0056b3;
        }
        .input-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 10px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #555;
        }
        input[type="number"], input[type="text"], input[type="date"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            width: 100%;
        }
        .decouple-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .decouple-group input {
            margin-right: 10px;
        }
        .ticker-tool {
            border-top: 1px solid #ddd;
            margin-top: 15px;
            padding-top: 15px;
        }
        .ticker-tool h4 {
            margin-top: 0;
            color: #28a745;
        }
        .ticker-tool button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        .ticker-tool button:hover {
            background-color: #218838;
        }
        .summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            text-align: center;
        }
        .summary div {
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
        }
        .summary h4 {
            margin: 0 0 10px 0;
        }
        @media (min-width: 900px) {
            .controls {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>High-Yield ETF Performance Comparator</h1>

        <div class="input-row">
            <div class="input-group">
                <label for="timeFrame">Time Frame (Weeks)</label>
                <input type="number" id="timeFrame" value="260" min="1" max="1040">
            </div>
        </div>

        <div class="controls">
            <!-- ETF 1 Controls -->
            <div class="etf-group" id="etf1-group">
                <h3>ETF 1 (Blue)</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label for="nav1">Initial NAV ($)</label>
                        <input type="number" id="nav1" value="50">
                    </div>
                    <div class="input-group">
                        <label for="navDecay1">NAV Decay (%/week)</label>
                        <input type="number" id="navDecay1" value="0.1" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="dist1">Distribution (%/year)</label>
                        <input type="number" id="dist1" value="20">
                    </div>
                    <div class="input-group">
                        <label for="distDecay1">Distro Decay (%/week)</label>
                        <input type="number" id="distDecay1" value="0.05" step="0.01">
                    </div>
                </div>
                <div class="decouple-group">
                    <input type="checkbox" id="decouple1">
                    <label for="decouple1">Decouple Yield from NAV</label>
                </div>
                <div class="input-row" id="decoupled-inputs1" style="display: none;">
                    <div class="input-group">
                        <label for="absoluteDist1">Distribution ($/week)</label>
                        <input type="number" id="absoluteDist1" value="0.2">
                    </div>
                    <div class="input-group">
                        <label for="absoluteDistDecay1">Distro Decay ($/week)</label>
                        <input type="number" id="absoluteDistDecay1" value="0.001" step="0.001">
                    </div>
                </div>
                <div class="ticker-tool">
                    <h4>Analyze Ticker</h4>
                    <div class="input-row">
                         <div class="input-group">
                            <label for="ticker1">Ticker</label>
                            <input type="text" id="ticker1" placeholder="e.g., QYLD">
                        </div>
                        <div class="input-group">
                            <label for="startDate1">Start Date</label>
                            <input type="date" id="startDate1">
                        </div>
                        <div class="input-group">
                            <label for="endDate1">End Date</label>
                            <input type="date" id="endDate1">
                        </div>
                    </div>
                    <button onclick="analyzeTicker(1)">Analyze (Simulation)</button>
                </div>
            </div>

            <!-- ETF 2 Controls -->
            <div class="etf-group" id="etf2-group">
                <h3>ETF 2 (Red)</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label for="nav2">Initial NAV ($)</label>
                        <input type="number" id="nav2" value="100">
                    </div>
                    <div class="input-group">
                        <label for="navDecay2">NAV Decay (%/week)</label>
                        <input type="number" id="navDecay2" value="0.01" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="dist2">Distribution (%/year)</label>
                        <input type="number" id="dist2" value="5">
                    </div>
                    <div class="input-group">
                        <label for="distDecay2">Distro Decay (%/week)</label>
                        <input type="number" id="distDecay2" value="0" step="0.01">
                    </div>
                </div>
                 <div class="decouple-group">
                    <input type="checkbox" id="decouple2">
                    <label for="decouple2">Decouple Yield from NAV</label>
                </div>
                <div class="input-row" id="decoupled-inputs2" style="display: none;">
                    <div class="input-group">
                        <label for="absoluteDist2">Distribution ($/week)</label>
                        <input type="number" id="absoluteDist2" value="0.1">
                    </div>
                    <div class="input-group">
                        <label for="absoluteDistDecay2">Distro Decay ($/week)</label>
                        <input type="number" id="absoluteDistDecay2" value="0" step="0.001">
                    </div>
                </div>
                 <div class="ticker-tool">
                    <h4>Analyze Ticker</h4>
                     <div class="input-row">
                         <div class="input-group">
                            <label for="ticker2">Ticker</label>
                            <input type="text" id="ticker2" placeholder="e.g., SCHD">
                        </div>
                        <div class="input-group">
                            <label for="startDate2">Start Date</label>
                            <input type="date" id="startDate2">
                        </div>
                        <div class="input-group">
                            <label for="endDate2">End Date</label>
                            <input type="date" id="endDate2">
                        </div>
                    </div>
                    <button onclick="analyzeTicker(2)">Analyze (Simulation)</button>
                </div>
            </div>
        </div>

        <div>
            <canvas id="etfChart"></canvas>
        </div>

        <div class="summary">
            <div id="summary1">
                <h4>ETF 1 Summary</h4>
                <p>Total Distributions: <span id="totalDist1">$0.00</span></p>
                <p>Total Return (DRIP): <span id="totalReturn1">$0.00</span></p>
            </div>
            <div id="summary2">
                <h4>ETF 2 Summary</h4>
                <p>Total Distributions: <span id="totalDist2">$0.00</span></p>
                <p>Total Return (DRIP): <span id="totalReturn2">$0.00</span></p>
            </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('etfChart').getContext('2d');
        let chart;

        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => input.addEventListener('input', () => {
            updateChart();
            updateURL();
        }));
        
        document.getElementById('decouple1').addEventListener('change', function() {
            document.getElementById('decoupled-inputs1').style.display = this.checked ? 'grid' : 'none';
        });

        document.getElementById('decouple2').addEventListener('change', function() {
            document.getElementById('decoupled-inputs2').style.display = this.checked ? 'grid' : 'none';
        });

        function analyzeTicker(num) {
            alert(`Ticker analysis is a demonstrative feature.\nIn a real-world application, this would use a financial data API to fetch historical NAV and distribution data for the ticker and date range provided.\n\nFor this simulation, we will populate the fields with sample data.`);
            if (num === 1) {
                document.getElementById('nav1').value = 22;
                document.getElementById('navDecay1').value = 0.15;
                document.getElementById('dist1').value = 12;
                document.getElementById('distDecay1').value = 0.1;
            } else {
                document.getElementById('nav2').value = 75;
                document.getElementById('navDecay2').value = -0.05; // Negative decay = appreciation
                document.getElementById('dist2').value = 3.5;
                document.getElementById('distDecay2').value = -0.02; // Negative decay = growth
            }
            updateChart();
            updateURL();
        }

        function getInputs(num) {
            return {
                nav: parseFloat(document.getElementById(`nav${num}`).value),
                navDecay: parseFloat(document.getElementById(`navDecay${num}`).value) / 100,
                dist: parseFloat(document.getElementById(`dist${num}`).value) / 100,
                distDecay: parseFloat(document.getElementById(`distDecay${num}`).value) / 100,
                decouple: document.getElementById(`decouple${num}`).checked,
                absoluteDist: parseFloat(document.getElementById(`absoluteDist${num}`).value),
                absoluteDistDecay: parseFloat(document.getElementById(`absoluteDistDecay${num}`).value)
            };
        }

        function calculateData() {
            const timeFrame = parseInt(document.getElementById('timeFrame').value);
            const data1 = getInputs(1);
            const data2 = getInputs(2);

            const results = {
                labels: [],
                etf1: { nav: [], cumDist: [], drip: [] },
                etf2: { nav: [], cumDist: [], drip: [] }
            };

            for (let i = 0; i <= timeFrame; i++) {
                results.labels.push(`Week ${i}`);
                calculateWeek(i, data1, results.etf1, 1);
                calculateWeek(i, data2, results.etf2, 2);
            }
            return results;
        }
        
        function calculateWeek(week, data, result, num) {
            if (week === 0) {
                result.nav.push(data.nav);
                result.cumDist.push(0);
                result.drip.push(data.nav); // Start with initial investment
                // Store initial values for DRIP calculation
                result.dripShares = 1; 
                result.cumulativeDistribution = 0;
                return;
            }

            // Calculate current NAV
            const currentNav = data.nav * Math.pow(1 - data.navDecay, week);
            result.nav.push(currentNav);

            // Calculate weekly distribution
            let weeklyDist;
            if (data.decouple) {
                weeklyDist = Math.max(0, data.absoluteDist - (data.absoluteDistDecay * (week -1)));
            } else {
                const weeklyDistRate = (data.dist / 52) * Math.pow(1 - data.distDecay, week);
                weeklyDist = currentNav * weeklyDistRate;
            }
            
            // Calculate cumulative distribution
            result.cumulativeDistribution += weeklyDist;
            result.cumDist.push(result.cumulativeDistribution);
            
            // Calculate DRIP
            const newShares = weeklyDist / currentNav;
            result.dripShares += newShares;
            result.drip.push(result.dripShares * currentNav);
        }

        function updateChart() {
            const { labels, etf1, etf2 } = calculateData();
            
            const datasets = [
                // ETF 1
                {
                    label: 'ETF 1 NAV',
                    data: etf1.nav,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    tension: 0.1,
                    type: 'line'
                },
                {
                    label: 'ETF 1 Cumulative Distribution',
                    data: etf1.cumDist,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    fill: true,
                    pointRadius: 0,
                    tension: 0.1,
                    type: 'line'
                },
                {
                    label: 'ETF 1 Total Return (DRIP)',
                    data: etf1.drip,
                    borderColor: 'rgba(0, 100, 200, 1)',
                    borderWidth: 3,
                    pointRadius: 0,
                    tension: 0.1,
                    type: 'line'
                },
                // ETF 2
                 {
                    label: 'ETF 2 NAV',
                    data: etf2.nav,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    tension: 0.1,
                    type: 'line'
                },
                {
                    label: 'ETF 2 Cumulative Distribution',
                    data: etf2.cumDist,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    fill: true,
                    pointRadius: 0,
                    tension: 0.1,
                    type: 'line'
                },
                 {
                    label: 'ETF 2 Total Return (DRIP)',
                    data: etf2.drip,
                    borderColor: 'rgba(200, 50, 80, 1)',
                    borderWidth: 3,
                    pointRadius: 0,
                    tension: 0.1,
                    type: 'line'
                }
            ];

            if (!chart) {
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value, index, values) {
                                        return '$' + value.toFixed(2);
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            },
                            legend: {
                                labels: {
                                    usePointStyle: true,
                                    pointStyle: (context) => {
                                         if (context.text.includes('DRIP')) {
                                            return 'rect'; // Using rect for DRIP, can be customized
                                        }
                                        return 'line';
                                    },
                                    generateLabels: (chart) => {
                                        const original = Chart.defaults.plugins.legend.labels.generateLabels;
                                        const labels = original(chart);
                                        labels.forEach(label => {
                                            if (label.text.includes('DRIP')) {
                                                label.fillStyle = 'rgba(0,0,0,0)';
                                                label.strokeStyle = label.borderColor;
                                            }
                                        });
                                        return labels;
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                chart.data.labels = labels;
                chart.data.datasets.forEach((dataset, i) => {
                    dataset.data = datasets[i].data;
                });
                chart.update();
            }

            // Update summary
            document.getElementById('totalDist1').textContent = `$${etf1.cumDist[etf1.cumDist.length - 1].toFixed(2)}`;
            document.getElementById('totalReturn1').textContent = `$${etf1.drip[etf1.drip.length - 1].toFixed(2)}`;
            document.getElementById('totalDist2').textContent = `$${etf2.cumDist[etf2.cumDist.length - 1].toFixed(2)}`;
            document.getElementById('totalReturn2').textContent = `$${etf2.drip[etf2.drip.length - 1].toFixed(2)}`;
        }

        function updateURL() {
            const params = new URLSearchParams();
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    params.set(input.id, input.checked);
                } else {
                    params.set(input.id, input.value);
                }
            });
            window.history.replaceState({}, '', `${window.location.pathname}?${params}`);
        }

        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);
            params.forEach((value, key) => {
                const input = document.getElementById(key);
                if (input) {
                    if (input.type === 'checkbox') {
                        input.checked = value === 'true';
                        // Manually trigger change event for checkboxes
                         if(key === 'decouple1' || key === 'decouple2') {
                           document.getElementById(`decoupled-inputs${key.slice(-1)}`).style.display = input.checked ? 'grid' : 'none';
                         }
                    } else {
                        input.value = value;
                    }
                }
            });
        }
        
        window.onload = () => {
            loadFromURL();
            updateChart();
        };

    </script>
</body>
</html>
